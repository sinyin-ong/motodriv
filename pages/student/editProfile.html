<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Basic Page Needs
    ================================================== -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Motodriv | Student Profile</title>

  <!-- Mobile Specific Metas
    ================================================== -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/icon" href="/img/jpg-png/motodriv-logo.png" />

  <!-- CSS
    ================================================== -->
  <!-- Bootstrap css file-->
  <link href="/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font awesome css file-->
  <link href="/css/font-awesome.min.css" rel="stylesheet" />
  <!-- Superslide css file-->
  <link rel="stylesheet" href="/css/superslides.css" />
  <!-- Slick slider css file -->
  <link href="/css/slick.css" rel="stylesheet" />
  <!-- Circle counter cdn css file -->
  <link rel="stylesheet prefetch"
    href="https://cdn.rawgit.com/pguso/jquery-plugin-circliful/master/css/jquery.circliful.css" />
  <!-- smooth animate css file -->
  <link rel="stylesheet" href="/css/animate.css" />
  <!-- preloader -->
  <link rel="stylesheet" href="/css/queryLoader.css" type="text/css" />
  <!-- gallery slider css -->
  <link type="text/css" media="all" rel="stylesheet" href="/css/jquery.tosrus.all.css" />
  <!-- Default Theme css file -->
  <link id="switcher" href="/css/themes/default-theme.css" rel="stylesheet" />
  <!-- Main structure css file -->
  <link href="/style.css" rel="stylesheet" />

  <!-- Google fonts -->
  <link href="http://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet" type="text/css" />
  <link href="http://fonts.googleapis.com/css?family=Varela" rel="stylesheet" type="text/css" />

  <!-- Sweet Alert-->
  <link rel="stylesheet" href="sweetalert2.min.css" />
</head>

<body class="cover-photo profile flex flex-col justify-center items-center">
  <div id="header"></div>
  <!-- <include src="/components/homeheader.html"></include> -->
  <h2 class="page-title">STUDENT PROFILE</h2>

  <div class="
        profile-container-wrapper
        flex flex-col
        justify-center
        items-center
      ">
    <div class="maxwidth-profile-box">
      <div class="maxwidth-profile-container">
        <div class="profile-container">
          <div class="profile-icon-wrapper">
            <img class="profile-icon" src="/img/svg/profileIcon.svg" />
          </div>
          <div class="edit-profile-icon-wrapper">
            <img class="edit-profile-icon" src="/img/jpg-png/editIcon.png" />
          </div>

          <div class="profile-frame">
            <div class="profile-frame-title">PROFILE</div>
            <table class="profile-table">
              <tr>
                <th>Student ID</th>
                <th class="profile-detail">20225115621</th>
              </tr>
              <tr>
                <td>Student Username</td>
                <td class="profile-detail">
                  <input type="text" id="stdUsername" name="stdUsername" maxlength="10" value="syinong" />
                </td>
              </tr>
              <tr>
                <td>Email Address</td>
                <td class="profile-detail">
                  <input type="email" id="stdEmail" name="stdEmail" value="syin@gmail.com" />
                </td>
              </tr>
              <tr>
                <td>Student Name</td>
                <td class="profile-detail">
                  <input type="text" id="stdName" name="stdName" value="Ong Sin Yin" />
                </td>
              </tr>
              <tr>
                <td>Date of Birth</td>
                <td class="profile-detail">
                  <input type="date" id="stdDOB" name="stdDOB" value="2001-08-08" />
                </td>
              </tr>
              <tr>
                <td>Gender</td>
                <td class="profile-detail">
                  <select id="stdGender" name="stdGender">
                    <option value="female">Female</option>
                    <option value="male">Male</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td>Phone Number</td>
                <td class="profile-detail">
                  <input type="tel" id="stdTel" name="stdTel" value="012-1234323" />
                </td>
              </tr>
              <tr>
                <td>Date of Enroll</td>
                <td class="profile-detail" id="dateOfEnrol">08/08/2021</td>
              </tr>
              <tr>
                <td>Date of Graduation</td>
                <td class="profile-detail">-</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
      <div class="flexend-button-wrapper">
        <button class="save-button" onclick="editProfile();">Save Changes</button>
      </div>
    </div>
  </div>
  <!-- Javascript Files
    ================================================== -->

  <!-- initialize jQuery Library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <!-- Preloader js file -->
  <!-- <script src="js/queryloader2.min.js" type="text/javascript"></script> -->
  <!-- For smooth animatin  -->
  <script src="/js/wow.min.js"></script>
  <!-- Bootstrap js -->
  <script src="/js/bootstrap.min.js"></script>
  <!-- slick slider -->
  <script src="/js/slick.min.js"></script>
  <!-- superslides slider -->
  <script src="/js/jquery.easing.1.3.js"></script>
  <script src="/js/jquery.animate-enhanced.min.js"></script>
  <script src="/js/jquery.superslides.min.js" type="text/javascript" charset="utf-8"></script>
  <!-- for circle counter -->
  <script src="https://cdn.rawgit.com/pguso/jquery-plugin-circliful/master/js/jquery.circliful.min.js"></script>
  <!-- Gallery slider -->
  <script type="text/javascript" language="javascript" src="/js/jquery.tosrus.min.all.js"></script>

  <script>

    function getCookie(cname) {
      let name = cname + "=";
      let decodedCookie = decodeURIComponent(document.cookie);
      let ca = decodedCookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }

    function populateFieldFromCookie() {
      let user = JSON.parse(getCookie('user'));
      if (user.studUsername) {
        document.getElementById('stdUsername').value = user.studUsername;
      }
      if (user.studEmail) {
        document.getElementById('stdEmail').value = user.studEmail;
      }
      if (user.studName) {
        document.getElementById('stdName').value = user.studName;
      }
      if (user.dateOfBirth) {
        document.getElementById('stdDOB').value = new Date(user.dateOfBirth).toLocaleDateString('en-CA');
      }
      if (user.gender) {
        document.getElementById('stdGender').value = user.gender;
      }
      if (user.phoneNum) {
        document.getElementById('stdTel').value = user.phoneNum;
      }
      if (user.createdAt) {
        document.getElementById('dateOfEnrol').innerHTML = new Date(user.createdAt).toLocaleDateString('en-CA');
      }
    }

    function editProfile() {
      let studUsername = JSON.parse(getCookie('user')).studUsername;
      let myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/x-www-form-urlencoded");

      let urlencoded = new URLSearchParams();
      urlencoded.append("studEmail", document.getElementById('stdEmail').value);
      urlencoded.append("studName", document.getElementById('stdName').value);
      urlencoded.append("dateOfBirth", document.getElementById('stdDOB').value);
      urlencoded.append("gender", document.getElementById('stdGender').value);
      urlencoded.append("phoneNum", document.getElementById('stdTel').value);


      let requestOptions = {
        method: 'PATCH',
        headers: myHeaders,
        body: urlencoded,
        redirect: 'follow'
      };

      fetch(`https://motodriv-api.herokuapp.com/api/admin/edit-student/${studUsername}`, requestOptions)
        .then(response => response.json())
        .then(result => {
          if (result.status) {
            document.cookie = `user=${JSON.stringify(result.user)}` + "; path=/";
          } else {
            console.log('something went wrong')
          }
        })
        .catch(error => console.log('error', error));
    }

    $(document).ready(function () {
      $("#header").load("/components/rolesheader.html");

      populateFieldFromCookie();
    });
  </script>

  <!-- Custom js-->
  <script src="/js/custom.js"></script>

  <!-- Sweet Alert-->
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="sweetalert2.all.min.js"></script>
  <script src="sweetalert2.min.js"></script>
  <!--=============================================== 
    Template Design By WpFreeware Team.
    Author URI : http://www.wpfreeware.com/
    ====================================================-->
</body>

</html>